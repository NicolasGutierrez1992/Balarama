<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>BALARAMA PRECIOS</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-KK94CHFLLe+nY2dmCWGMq91rCGa5gtU4mk92HdvYe+M/SXH301p5ILy+dN9+nJOZ" crossorigin="anonymous">
  
  </head>
  <body>
    <div class="container text-cente.25 mt4 col-lg-6 mx-auto text-center"   >
        
        <br><br>
        <div class="text-bg-secondary p-3  px-100 gap-5  p-4 mb-2" >ESTAS CAMBIANDO PRECIOS</div>
        <br><br>
        <div class="precioNuevo">
            <!-- <form method="POST" id="update"> -->
                <h1 class=" text-center display-5 fw-bold text-body-emphasis"> Actualiz√°</h1>
                <input id="CodeBar" type="text" class="text-center form-control" placeholder="CODIGO DE BARRA" >
                <input id="Nombre" type="text" class="text-center form-control" placeholder="NOMBRE PRODUCTO" >
                <input id="NuevoPrecio" type="text" class="text-center form-control" placeholder="PRECIO NUEVO">
                <button id="enviar" type="click" class="btn btn-primary btn-lg  px-4 gap-5">GUARDAR</button>
                <div class="mensajeOK  p-3 mb-2 bg-success text-white " style="display: none"></div>
            <!-- </form> -->
        </div>
    </div>
    
    <script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.11.7/dist/umd/popper.min.js" integrity="sha384-zYPOMqeu1DAVkHiLqWBUTcbYfZ8osu1Nd6Z89ify25QV9guujx43ITvfi12/QExE" crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha3/dist/js/bootstrap.min.js" integrity="sha384-Y4oOpwW3duJdCWv5ly8SCFYWqFDsfob/3GkgExXKV4idmbt98QcxXYs9UoXAB7BZ" crossorigin="anonymous"></script>
    <script>

        const inputCodebar = document.getElementById('CodeBar');
        const inputNombre = document.getElementById('Nombre');
        const inputNuevoPrecio = document.getElementById('NuevoPrecio');
        const buttonEnviar = document.getElementById('enviar');
        const PreciosNuevoOk =  document.querySelector('.mensajeOK');

        
        buttonEnviar.addEventListener('click',(e)=>{
            try {
                e.preventDefault();
                console.log("buttonEnviar");
                EnviarPrecio(inputCodebar.value,inputNombre.value,NuevoPrecio.value);
            } catch (error) {
                console.log("buttonEnviar ERROR");
                PreciosNuevoOk.textContent = "ARTICULO NO EXISTEE: ERROR: " + error;
				inputCodebar.value = "0";
				inputCodebar.textContent="0";
                inputNombre.value = "PRUEBA";
				inputNombre.textContent="PRUEBA";
                inputCodebar.focus();
            }  
        })
		
		function EnviarPrecio(codebar,  nombre, precio){
            let update = "1";

            if (codebar == "") {codebar = "0";} 
            if (nombre == "") {nombre = "PRUEBA";} 
            if (precio == "") {precio = "0";} 


            let reqJson = {Codbar:codebar, Precio:precio,Nombre:nombre,Update:update};
            console.log("EnviarPrecio");
            fetch(`https://balarama.onrender.com/updateWeb/`,{
                method:'POST',
                body: JSON.stringify(reqJson),
                headers:{
                    'Content-Type':'application/json; charset=utf-8',
                }
            })
            .then((data)=>{
                console.log(data);
                PreciosNuevoOk.textContent ="PRECIO ACTUALIZADO";
                inputCodebar.value = "";
				inputCodebar.textContent="";
                inputNombre.value = "";
				inputNombre.textContent="";
				inputNuevoPrecio.textContent ="";
				inputNuevoPrecio.value ="";
				inputCodebar.focus();
			});
        
        }
		
	
        inputCodebar.addEventListener('keydown', inputCodebarCharacters);
        inputNombre.addEventListener('keydown', inputNombreCharacters);


        function inputCodebarCharacters(event) {
            if (event.keyCode == 13) {
                inputNuevoPrecio.focus();
                traerPrecio(inputCodebar.value);
            }
        }
        function traerPrecio(codebar){
            fetch(`https://balarama.onrender.com/update/${codebar}/`)
            .then((res)=>res.json())
            .then((data)=>mostrarPrecio(data[0]));
        }
        function mostrarPrecio(precio){
            try {
                inputNombre.value       = precio.nombre;
                inputNombre.textContent = precio.nombre;
                
                inputNuevoPrecio.value       = precio.precio;
                inputNuevoPrecio.textContent = precio.precio;
                inputNuevoPrecio.focus();

            } catch (error) {
               // Precios.textContent ="ARTICULO NO EXISTE";
				inputNuevoPrecio.value = "";
				inputNuevoPrecio.textContent="";
                inputNombre.value = "NO ENCONTRADO";
				inputNombre.textContent="NO ENCONTRADO";
                inputNuevoPrecio.focus();
            }
           
        }
        function inputNombreCharacters(event) {
            if (event.keyCode == 13) {
                inputNuevoPrecio.focus();
            }
        }
    </script>
    
</body>
 
</html>